{"version":3,"file":"VisualEditingComponent.cjs","sources":["../../src/next-pages-router/VisualEditingComponent.tsx"],"sourcesContent":["import {useRouter} from 'next/router.js'\nimport {useEffect, useRef, useState} from 'react'\nimport type {HistoryAdapterNavigate, VisualEditingOptions} from '../types'\nimport {enableVisualEditing} from '../ui/enableVisualEditing'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history'> {\n  /**\n   * @deprecated The history adapter is already implemented\n   */\n  history?: never\n}\n\nexport default function VisualEditingComponent(props: VisualEditingProps): null {\n  const {components, refresh, zIndex} = props\n\n  const router = useRouter()\n  const routerRef = useRef(router)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n\n  useEffect(() => {\n    routerRef.current = router\n  }, [router])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      components,\n      zIndex,\n      refresh,\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          switch (update.type) {\n            case 'push':\n              return routerRef.current.push(update.url)\n            case 'pop':\n              return routerRef.current.back()\n            case 'replace':\n              return routerRef.current.replace(update.url)\n            default:\n              throw new Error(`Unknown update type: ${update.type}`)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [components, refresh, zIndex])\n\n  const {asPath, basePath, locale, isReady} = useRouter()\n  useEffect(() => {\n    if (navigate && isReady) {\n      const url =\n        basePath || locale\n          ? `${basePath}${locale ? `/${locale}` : ''}${asPath === '/' ? '' : asPath}`\n          : asPath\n      navigate({type: 'push', url})\n    }\n  }, [asPath, basePath, isReady, locale, navigate])\n\n  return null\n}\n"],"names":["exports","default","props","components","refresh","zIndex","router","useRouter","routerRef","useRef","navigate","setNavigate","useState","useEffect","current","disable","enableVisualEditing","history","subscribe","_navigate","update","type","push","url","back","replace","Error","asPath","basePath","locale","isReady"],"mappings":"uGAgEAA,QAAAC,QAjDA,SAA+CC,GACvC,MAAAC,WAACA,UAAYC,EAASC,OAAAA,GAAUH,EAEhCI,EAASC,EAAAA,YACTC,EAAYC,EAAAA,OAAOH,IAClBI,EAAUC,GAAeC,aAEhCC,EAAAA,WAAU,KACRL,EAAUM,QAAUR,CAAA,GACnB,CAACA,IACJO,EAAAA,WAAU,KACF,MAAAE,EAAUC,EAAAA,EAAoB,CAClCb,aACAE,SACAD,UACAa,QAAS,CACPC,UAAYC,IACVR,GAAY,IAAMQ,IACX,IAAMR,OAAY,IAE3BS,OAASA,IACP,OAAQA,EAAOC,MACb,IAAK,OACH,OAAOb,EAAUM,QAAQQ,KAAKF,EAAOG,KACvC,IAAK,MACI,OAAAf,EAAUM,QAAQU,OAC3B,IAAK,UACH,OAAOhB,EAAUM,QAAQW,QAAQL,EAAOG,KAC1C,QACE,MAAM,IAAIG,MAAM,wBAAwBN,EAAOC,QAAM,KAK/D,MAAO,IAAMN,GAAQ,GACpB,CAACZ,EAAYC,EAASC,IAEzB,MAAMsB,OAACA,EAAQC,SAAAA,EAAAC,OAAUA,UAAQC,GAAWvB,EAAAA,YAC5CM,OAAAA,EAAAA,WAAU,KACJH,GAAYoB,GAKdpB,EAAS,CAACW,KAAM,OAAQE,IAHtBK,GAAYC,EACR,GAAGD,IAAWC,EAAS,IAAIA,IAAW,KAAgB,MAAXF,EAAiB,GAAKA,IACjEA,GACsB,GAE7B,CAACA,EAAQC,EAAUE,EAASD,EAAQnB,IAEhC,IACT"}